{% extends 'base.html' %}

{% block title %}Dashboard Master{% endblock %}

{% block content %}
  <!-- Mensagens flash -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <p class="text-center mb-4 {{ 'text-red-500' if category == 'error' else 'text-green-500' }}">{{ message }}</p>
      {% endfor %}
    {% endif %}
  {% endwith %}
  <header class="header flex justify-between items-center mb-8 animate-fade-in">
    <div>
      <h1 class="text-3xl font-bold text-gray-800">Dashboard Master</h1>
      <p class="text-gray-600">Visão estratégica do sistema de saneamento municipal</p>
    </div>
    <div class="flex space-x-2">
      <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-transform duration-200">Auditoria</button>
      <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-transform duration-200">Relatório Executivo</button>
      <button class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-transform duration-200">Configurações</button>
      <button id="theme-toggle" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-transform duration-200">
        <i class="fas fa-moon"></i>
      </button>
      <a href="{{ url_for('main.logout') }}" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-transform duration-200">
        <i class="fas fa-sign-out-alt mr-2"></i> Sair
      </a>
    </div>
  </header>

  <section class="stats-cards grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8 animate-fade-in">
    <div class="card p-6 animate-scale-up">
      <h3 class="text-sm text-gray-500 mb-2 flex items-center"><i class="fas fa-users mr-1"></i> Usuários Ativos</h3>
      <div class="value text-2xl font-bold text-gray-800">47</div>
      <div class="trend positive text-green-500 text-sm mt-2">+4% em relação ao mês anterior</div>
    </div>
    <div class="card p-6 animate-scale-up">
      <h3 class="text-sm text-gray-500 mb-2 flex items-center"><i class="fas fa-chart-line mr-1"></i> Eficiência Geral</h3>
      <div class="value text-2xl font-bold text-gray-800">91%</div>
      <div class="trend positive text-green-500 text-sm mt-2">+2% em relação ao mês anterior</div>
    </div>
    <div class="card p-6 animate-scale-up">
      <h3 class="text-sm text-gray-500 mb-2 flex items-center"><i class="fas fa-leaf mr-1"></i> Impacto Ambiental</h3>
      <div class="value text-2xl font-bold text-gray-800">Positivo</div>
    </div>
    <div class="card p-6 animate-scale-up">
      <h3 class="text-sm text-gray-500 mb-2 flex items-center"><i class="fas fa-exclamation-triangle mr-1"></i> Alertas Críticos</h3>
      <div class="value text-2xl font-bold text-gray-800">3</div>
      <div class="trend negative text-red-500 text-sm mt-2">Requer ação imediata</div>
    </div>
  </section>

  <section class="grid-two grid grid-cols-1 lg:grid-cols-2 gap-6 animate-fade-in">
    <div class="card p-6">
      <h3 class="text-sm text-gray-500 mb-4 flex items-center"><i class="fas fa-chart-pie mr-1"></i> Indicadores Ambientais</h3>
      <div class="space-y-4">
        <div>
          <p class="text-gray-600">Qualidade do Ar: 85%</p>
          <div class="progress-bar h-3 mt-2"><div class="bg-blue-600 h-full animate-progress" style="width:0%" data-width="85%"></div></div>
        </div>
        <div>
          <p class="text-gray-600">Qualidade da Água: 92%</p>
          <div class="progress-bar h-3 mt-2"><div class="bg-green-500 h-full animate-progress" style="width:0%" data-width="92%"></div></div>
        </div>
        <div>
          <p class="text-gray-600">Gestão de Resíduos: 78%</p>
          <div class="progress-bar h-3 mt-2"><div class="bg-yellow-500 h-full animate-progress" style="width:0%" data-width="78%"></div></div>
        </div>
        <div>
          <p class="text-gray-600">Cobertura Verde: 65%</p>
          <div class="progress-bar h-3 mt-2"><div class="bg-blue-600 h-full animate-progress" style="width:0%" data-width="65%"></div></div>
        </div>
      </div>
      <canvas id="envChart" class="mt-6" height="200"></canvas>
    </div>
    <div class="card p-6">
      <h3 class="text-sm text-gray-500 mb-4 flex items-center"><i class="fas fa-bell mr-1"></i> Alertas Críticos</h3>
      <div class="space-y-4">
        <div class="alert high flex justify-between items-center p-4 bg-red-50 border-l-4 border-red-500 rounded-lg transition-transform duration-200 hover:scale-105">
          <span class="text-gray-800">Equipamento com falha no Setor B</span>
          <button class="resolve-btn px-3 py-1 bg-red-500 text-white rounded-md hover:bg-red-600">Resolver</button>
        </div>
        <div class="alert medium flex justify-between items-center p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg transition-transform duration-200 hover:scale-105">
          <span class="text-gray-800">Meta de coleta não atingida - Zona Sul</span>
          <button class="resolve-btn px-3 py-1 bg-yellow-500 text-white rounded-md hover:bg-yellow-600">Resolver</button>
        </div>
        <div class="alert low flex justify-between items-center p-4 bg-blue-50 border-l-4 border-blue-500 rounded-lg transition-transform duration-200 hover:scale-105">
          <span class="text-gray-800">Novo funcionário aguarda aprovação</span>
          <button class="resolve-btn px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600">Resolver</button>
        </div>
      </div>
    </div>
  </section>

  <div id="resolve-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="bg-white p-6 rounded-lg text-center">
      <p class="text-green-600">Alerta resolvido com sucesso!</p>
    </div>
  </div>

  <script>
    document.querySelectorAll('.animate-progress').forEach(bar => {
      bar.style.width = bar.dataset.width;
    });

    const ctx = document.getElementById('envChart').getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Ar', 'Água', 'Resíduos', 'Verde'],
        datasets: [{
          data: [85, 92, 78, 65],
          backgroundColor: ['#2563eb', '#22c55e', '#facc15', '#3b82f6']
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { position: 'top' } }
      }
    });
  </script>
{% endblock %}